document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("generate-ai-btn");if(!e)return;const s=document.getElementById("ai-loading"),t=document.getElementById("ai-content"),i=document.getElementById("ai-result"),a=document.getElementById("ai-error"),d=document.getElementById("ai-error-message"),c=document.getElementById("ai-placeholder");e.addEventListener("click",async function(){const r=e.dataset.route,l=e.dataset.csrf;if(!r){console.error("Route URL not found");return}c.classList.add("hidden"),t.classList.add("hidden"),a.classList.add("hidden"),s.classList.remove("hidden"),e.disabled=!0,e.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Menganalisis...';try{const n=await(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":l}})).json();if(s.classList.add("hidden"),n.success){if(t.classList.remove("hidden"),typeof marked<"u"){const m=marked.parse(n.analysis);i.innerHTML=m}else i.textContent=n.analysis,console.warn("Marked.js not loaded");e.innerHTML='<i class="fas fa-sync mr-2"></i> Generate Ulang'}else a.classList.remove("hidden"),d.textContent=n.error||"Terjadi kesalahan saat menganalisis data"}catch(o){s.classList.add("hidden"),a.classList.remove("hidden"),d.textContent="Gagal terhubung ke server: "+o.message}finally{e.disabled=!1,t.classList.contains("hidden")?e.innerHTML='<i class="fas fa-magic mr-2"></i> Generate Analisis':e.innerHTML='<i class="fas fa-sync mr-2"></i> Generate Ulang'}})});
